<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>フドキ ― 言葉の「風土」を記す、日本語解析ツール</title>
  <link rel="stylesheet" href="static/styles.css">
  <!-- 移动端样式：仅在移动设备加载，优先级高于主样式 -->
  <link rel="stylesheet" href="static/mobile.css" media="(max-width: 768px)">
  <link rel="icon" type="image/png" href="static/logo.png">
</head>
<body>

  <div id="pwaInstallToast" class="pwa-toast" role="status" aria-live="polite" aria-atomic="true" hidden>
    <div class="pwa-toast__icon" id="pwaInstallIcon" aria-hidden="true"></div>
    <div class="pwa-toast__content">
      <div class="pwa-toast__title" id="pwaInstallTitle">离线资源包</div>
      <div class="pwa-toast__message" id="pwaInstallMessage">正在准备离线资源…</div>
      <div class="pwa-toast__progress" id="pwaInstallProgress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="pwa-toast__progress-bar" id="pwaInstallProgressBar"></div>
      </div>
    </div>
    <button class="pwa-toast__close" id="pwaToastClose" type="button" aria-label="关闭提示">✕</button>
  </div>

  <!-- 主要内容区域 -->
  <div class="main-container">
    <!-- 移动端抽屉：将左侧文件夹与文档列表上下堆叠展示 -->
    <div class="sidebar-stack" id="sidebarStack">

      <!-- Notion风格侧边栏 -->
      <aside class="folder-management" id="sidebar-left" aria-label="导航侧边栏">
        <div class="sidebar-scroll" id="sidebarScroll">
          <!-- 全局搜索（位于顶部） -->
          <section class="search-section" id="globalSearch" aria-label="全局搜索">
            <div class="search-row">
              <div class="search-input-wrapper">
                <span class="search-icon" aria-hidden="true">🔍</span>
                <input type="text" id="globalSearchInput" placeholder="快速搜索关键词" autocomplete="off" aria-label="搜索全部文档">
                <button type="button" id="globalSearchClear" class="search-clear" aria-label="清除搜索">×</button>
              </div>
              <button type="button" class="btn-new theme-icon-btn editorNewBtn" id="newDocBtn" aria-label="新建文档" title="新建文档">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path d="M8 3h6l5 5v11a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3z" fill="none"></path>
                  <path d="M14 3v5h5" fill="none"></path>
                  <path d="M12 11v6" fill="none"></path>
                  <path d="M9 14h6" fill="none"></path>
                </svg>
              </button>
            </div>
            <div class="search-info" id="globalSearchInfo"></div>
          </section>

          <!-- 文件夹区域 -->
          <section class="sidebar-section folder-section" aria-labelledby="sidebarFolderTitle">
            <div class="folder-title-row">
              <div class="sidebar-title" id="sidebarFolderTitle">文件夹管理</div>
              <button type="button" class="btn-sort theme-icon-btn desc" id="docSortToggle" aria-label="切换时间排序" title="切换时间排序">
                <svg class="sort-icon" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                  <path class="arrow-up" d="M12 7l-4 4h8z"></path>
                  <path class="arrow-down" d="M12 17l4-4H8z"></path>
                </svg>
              </button>
            </div>
            <div class="folder-list" id="folderList">
              <!-- 文件夹列表由 JS 生成 -->
            </div>
          </section>

          <!-- 文档列表 -->
          <section class="list-panel" id="listPanel" aria-label="文档列表">
            <div class="doc-list" id="documentList">
              <!-- 文档列表由 JS 生成 -->
            </div>
          </section>
        </div>

        <!-- 底部按钮组 -->
        <div class="folder-bottom-buttons">
          <button class="theme-icon-btn app-icon" id="appIcon" aria-label="应用程序" title="应用程序">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor">
              <circle cx="6" cy="6" r="2"/>
              <circle cx="12" cy="6" r="2"/>
              <circle cx="18" cy="6" r="2"/>
              <circle cx="6" cy="12" r="2"/>
              <circle cx="12" cy="12" r="2"/>
              <circle cx="18" cy="12" r="2"/>
              <circle cx="6" cy="18" r="2"/>
              <circle cx="12" cy="18" r="2"/>
              <circle cx="18" cy="18" r="2"/>
            </svg>
          </button>
          <button class="theme-icon-btn" id="syncBtn" aria-label="同步" title="同步">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-refresh" aria-hidden="true">
              <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" />
              <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" />
            </svg>
          </button>
          <button class="theme-icon-btn" id="settingsButton" aria-label="设置" title="设置">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor">
              <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.13,5.91,7.63,6.29L5.23,5.33c-0.22-0.09-0.47,0-0.59,0.22L2.72,8.87c-0.11,0.2-0.06,0.46,0.12,0.61l2.03,1.58c-0.05,0.3-0.07,0.62-0.07,0.94c0,0.33,0.02,0.64,0.06,0.94l-2.03,1.58c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54c0.04,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.43-0.17,0.48-0.41l0.36-2.54c0.59-0.24,1.12-0.56,1.62-0.94l2.39,0.96c0.22,0.09,0.47,0,0.59-0.22l1.92-3.32c0.11-0.2,0.06-0.46-0.12-0.61L19.14,12.94z M12,15.5c-1.93,0-3.5-1.57-3.5-3.5S10.07,8.5,12,8.5s3.5,1.57,3.5,3.5S13.93,15.5,12,15.5z"/>
            </svg>
          </button>
          <button class="theme-icon-btn" id="headerDownloadBtn" aria-label="下载" title="下载">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor">
              <path d="M5 20h14v-2H5v2z" />
              <path d="M12 4v8l-4-4-1.4 1.4L12 15.8l5.4-5.4L16 8l-4 4V4z" />
            </svg>
          </button>
          <button id="theme-toggle" class="theme-toggle" aria-label="切换到暗色主题" title="切换到暗色主题"><span class="theme-icon">🌙</span></button>
        </div>
      </aside>
    </div>

   
    
    <!-- 右侧列 - 内容区域 -->
    <main class="content-main">
      <div class="content-container">
         <!-- 编辑工具栏：显示创建日期、字数、星标与阅读模式 -->
        <section class="editor-toolbar" id="editorToolbar" aria-label="文档工具栏">
          <div class="editor-toolbar-left">
            <!-- 折叠按钮 -->
            <button type="button" class="folder-collapse-btn theme-icon-btn" id="folderToolbarCollapseBtn" aria-label="收起文件夹工具栏" title="收起/展开">
              <svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" fill="currentColor">
                <path d="M3.608 10.442a.625.625 0 0 1 0-.884l5.4-5.4a.625.625 0 0 1 .884.884L4.934 10l4.958 4.958a.625.625 0 1 1-.884.884z"></path>
                <path d="m14.508 4.158-5.4 5.4a.625.625 0 0 0 0 .884l5.4 5.4a.625.625 0 1 0 .884-.884L10.434 10l4.958-4.958a.625.625 0 1 0-.884-.884"></path>
              </svg>
            </button>
            <!-- Logo -->
            <a href="#" class="logo">
              <img src="static/logo.png" alt="Fudoki" class="logo-icon">
              <span class="logo-text" id="logoText">Fudoki</span>
            </a>
            <button class="theme-icon-btn" id="twoPaneToggle" aria-label="两栏模式" title="两栏模式">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor">
                <!-- 左右两栏：左窄右宽 -->
                <rect x="3" y="4" width="7" height="16" rx="1" ry="1" opacity="0.85"></rect>
                <rect x="11" y="4" width="10" height="16" rx="1" ry="1" opacity="0.45"></rect>
              </svg>
            </button>
            <span class="editor-date" id="editorDocDate" title="创建日期"></span>
            <span class="editor-count" id="editorCharCount" title="字数">0 字</span>
          </div>
          <div class="editor-toolbar-right">
            <!-- 字号滑动手柄（最左侧） -->
            <div class="editor-fontsize-control" id="editorFontSizeControl">
              <input type="range" id="editorFontSizeRange" min="0.8" max="1.5" step="0.05" value="1" aria-label="字号">
              <div class="font-size-display" id="editorFontSizeValue">100%</div>
            </div>
            <!-- 字体选择（分别控制编辑区与显示区） -->
            <div class="editor-fontfamily-controls" id="editorFontFamilyControls">
              <label class="sr-only" for="editorInputFontSelect">编辑区字体</label>
              <select id="editorInputFontSelect" title="编辑区字体" aria-label="编辑区字体">
                <option value="system-ui,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Helvetica,Arial,\"Noto Sans\",\"Apple Color Emoji\",\"Segoe UI Emoji\"">系统默认</option>
                <option value="-apple-system,\"SF Pro Text\",system-ui,BlinkMacSystemFont">SF Pro</option>
                <option value="PingFang SC,\"Microsoft YaHei\",system-ui,Arial,Helvetica">中文黑体</option>
                <option value="Hiragino Sans,Meiryo,\"Yu Gothic\",system-ui">日文字体(无衬线)</option>
                <option value="Hiragino Mincho Pro,Noto Serif JP,\"Times New Roman\",Georgia,serif">日文字体(衬线)</option>
                <option value="Menlo,Monaco,Consolas,\"Courier New\",monospace">等宽字体</option>
              </select>
              <label class="sr-only" for="editorContentFontSelect">显示区字体</label>
              <select id="editorContentFontSelect" title="显示区字体" aria-label="显示区字体">
                <option value="system-ui,-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,Helvetica,Arial,\"Noto Sans\",\"Apple Color Emoji\",\"Segoe UI Emoji\"">系统默认</option>
                <option value="-apple-system,\"SF Pro Text\",system-ui,BlinkMacSystemFont">SF Pro</option>
                <option value="PingFang SC,\"Microsoft YaHei\",system-ui,Arial,Helvetica">中文黑体</option>
                <option value="Hiragino Sans,Meiryo,\"Yu Gothic\",system-ui">日文字体(无衬线)</option>
                <option value="Hiragino Mincho Pro,Noto Serif JP,\"Times New Roman\",Georgia,serif">日文字体(衬线)</option>
                <option value="Menlo,Monaco,Consolas,\"Courier New\",monospace">等宽字体</option>
              </select>
            </div>
            <button class="theme-icon-btn" id="editorDeleteBtn" aria-label="删除文档" title="删除文档">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path d="M9 4h6l1 2h4" fill="none"></path>
                <path d="M4 6h16" fill="none"></path>
                <path d="M7.5 9L8.3 20a2 2 0 0 0 2 1.8h3.4a2 2 0 0 0 2-1.8L17.5 9" fill="none"></path>
                <path d="M11 12v5" fill="none"></path>
                <path d="M13 12v5" fill="none"></path>
              </svg>
            </button>
            <button type="button" class="editor-star-toggle theme-icon-btn" id="editorStarToggle" aria-pressed="false" title="加星">☆</button>
            <!-- 将阅读模式按钮改为“展开菜单”按钮，样式与功能一致 -->
            <button class="theme-icon-btn" id="collapseMenuBtn" aria-label="展开菜单" title="展开菜单">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path d="M5 7h14" fill="none"></path>
                <path d="M5 12h14" fill="none"></path>
                <path d="M5 17h14" fill="none"></path>
              </svg>
            </button>
          </div>
        </section>

        <div class="editor-panels" id="editorPanels">
        <!-- 输入区域 -->
        <section class="input-section">
          <div class="input-group">
            <textarea id="textInput" placeholder="在此输入日语文本进行分析..."></textarea>
            <!-- 移除分析按钮：改为在文本域失去焦点且结构变化时自动解析 -->
          </div>
          <!-- 顶部播放控制栏：左播放按钮 + 中进度条 + 右音量 -->
        <div class="play-control-bar" id="headerPlayControl" aria-label="播放控制栏">
          <div class="play-control-bar-buttons">
            <button class="theme-icon-btn play-toggle" id="headerPlayToggle" aria-label="播放全文" title="播放全文">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor">
                <path d="M8 5v14l11-7z" fill="currentColor"></path>
              </svg>
            </button>
            <!-- 暂停/恢复按钮 -->
            <button class="theme-icon-btn pause-toggle" id="headerPauseToggle" aria-label="暂停" title="暂停">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor">
                <path d="M6 5h4v14H6z" fill="currentColor"></path>
                <path d="M14 5h4v14h-4z" fill="currentColor"></path>
              </svg>
            </button>
          </div>
          
          <div class="play-progress" id="headerPlayProgress" aria-label="播放进度" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="play-progress-fill" id="headerPlayProgressFill"></div>
          </div>
          
          <!-- 头部语音与速度控件 -->
          <div class="header-voice-controls" id="headerVoiceControls" aria-label="语音与速度设置">

            <input type="range" id="headerSpeedRange" min="0.5" max="2" step="0.1" value="1" aria-label="話速">
            <div class="speed-display" id="headerSpeedValue">1.0x</div>
            <select id="headerVoiceSelect">
              <option value="">音声を選択...</option>
            </select>
          </div>
          <input type="range" id="headerVolume" class="play-volume" min="0" max="1" step="0.05" value="1" aria-label="音量" title="音量">
        </div>
        </section>
        
        <!-- 结果显示区域 -->
        <section class="content-area" id="content">
          <div class="empty-state">
            <p id="emptyText">请在上方输入日语文本，点击"分析文本"开始处理</p>
          </div>
        </section>
        </div>
      </div>
    </main>
     <!-- 移动端侧边栏遮罩层 -->
     <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <!-- 设置弹窗 -->
    <div class="settings-modal" id="settingsModal">
      <div class="settings-modal-content">
        <!-- 弹窗标题栏 -->
        <div class="settings-modal-header">
          <div class="settings-modal-title">
            <svg class="settings-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
            </svg>
            <span id="voiceTitle">系统设置</span>
          </div>
          <button class="settings-modal-close" id="settingsModalClose" title="关闭">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
      
      <!-- 工具栏内容（弹窗内保留空容器，避免与内嵌设置重复ID） -->
       <div class="toolbar-content" id="settingsModalBody"></div>
     </div>
   </div>

   <!-- 右侧边栏已移除，统一使用顶部齿轮打开的设置弹窗 -->

  <!-- 应用程序列表侧边栏 -->
  <div class="app-drawer" id="appDrawer" aria-hidden="true">
    <div class="app-drawer-content">
      <div class="app-drawer-header">
        <h3 class="app-drawer-title" id="appDrawerTitle">应用程序</h3>
        <button class="app-drawer-close" id="appDrawerClose" aria-label="关闭应用程序列表">✕</button>
      </div>
      <div class="app-drawer-body">
        <div class="app-list">
          <div class="app-item" data-app="fudoki">
            <div class="app-icon-large">
              <img src="https://fudoki.iamcheyan.com/static/logo.png" alt="Fudoki" width="32" height="32" />
            </div>
            <div class="app-info">
              <div class="app-name">Fudoki</div>
              <div class="app-desc">日本語学習者や自然言語処理研究者向けの日本語テキスト分析ツール。</div>
            </div>
          </div>

          <div class="app-item" data-app="terebi">
            <div class="app-icon-large">
              <img src="https://terebi.iamcheyan.com/img/svg/logo.svg" alt="Terebi" width="32" height="32" />
            </div>
            <div class="app-info">
              <div class="app-name">Terebi</div>
              <div class="app-desc">日本全国100以上のテレビ局の公開番組をオンラインで視聴可能。</div>
            </div>
          </div>

          <div class="app-item" data-app="kotoba">
            <div class="app-icon-large">
              <img src="https://kotoba.iamcheyan.com/static/favicon.svg" alt="Kotoba" width="32" height="32" />
            </div>
            <div class="app-info">
              <div class="app-name">Kotoba</div>
              <div class="app-desc">オンライン日本語単語暗記ツール。辞書切替や各種補助表示設定に対応。</div>
            </div>
          </div>
        </div>
      </div>
      <div class="app-drawer-footer">
        <div class="user-profile">
          <!-- <div class="user-avatar">
            <svg viewBox="0 0 24 24" width="40" height="40" fill="currentColor">
              <path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"/>
            </svg>
          </div> -->
          <!-- <div class="user-info">
            <div class="user-email">iamcheyan.com</div>
          </div> -->
        </div>
        <footer class="footer" role="contentinfo">
            <div class="footer-inner">
              <span class="footer-copy">©</span>
              <a href="https://iamcheyan.com/" target="_blank" rel="noreferrer noopener" class="footer-brand" title="iamcheyan.com">Cheyan</a>
              <span class="footer-copy">All Rights Reserved</span>
              <span class="footer-sep">•</span>
              <a href="https://github.com/iamcheyan/fudoki" target="_blank" rel="noreferrer noopener" class="footer-link" aria-label="GitHub" title="GitHub">
                <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" fill="currentColor"><path d="M12 .5a11.5 11.5 0 0 0-3.64 22.42c.58.11.8-.25.8-.56v-2.02c-3.26.71-3.95-1.4-3.95-1.4-.53-1.36-1.3-1.72-1.3-1.72-1.06-.72.08-.71.08-.71 1.18.08 1.8 1.21 1.8 1.21 1.04 1.79 2.73 1.27 3.4.97.11-.76.41-1.27.75-1.56-2.6-.3-5.33-1.3-5.33-5.8 0-1.28.46-2.32 1.21-3.14-.12-.3-.52-1.52.11-3.17 0 0 .98-.31 3.2 1.2.94-.26 1.95-.39 2.95-.39s2.01.13 2.95.39c2.22-1.51 3.19-1.2 3.19-1.2.64 1.65.24 2.87.12 3.17.76.82 1.21 1.86 1.21 3.14 0 4.51-2.73 5.5-5.34 5.79.42.36.8 1.08.8 2.18v3.23c0 .31.21.68.81.56A11.5 11.5 0 0 0 12 .5Z"></path></svg>
                <span class="footer-link-label">GitHub</span>
              </a>
            </div>
          </footer>
        <!-- <button class="logout-btn" id="logoutBtn">退出</button> -->
      </div>
    </div>
  </div>
  <div class="app-drawer-backdrop" id="appDrawerBackdrop" aria-hidden="true"></div>
    
  </div>

  <button type="button" class="reading-mode-toggle" id="readingModeToggle" aria-pressed="false" title="阅读模式">
    <span class="reading-toggle-icon" aria-hidden="true">
      <span class="reading-icon-lines"></span>
    </span>
  </button>

  
  <!-- JavaScript文件 -->
  <script src="static/libs/kuromoji.js"></script>
  <script src="static/libs/kuroshiro.min.js"></script>
  <script src="static/libs/kuroshiro-analyzer-kuromoji.min.js"></script>
  <script src="static/libs/dict/dictionary-service.js"></script>
  <script src="static/segmenter.js"></script>
  <script src="static/js/dictionary.js"></script>
  <script src="static/js/ui-utils.js"></script>
  <script src="static/js/tts.js"></script>
  <script src="static/main-js.js"></script>
</body>
</html>
